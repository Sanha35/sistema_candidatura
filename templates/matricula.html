<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Matrícula - Sistema de Registo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        h2 { color: #0d6efd; }
        table input, table select { width: 100%; }
        nav a { margin-right: 15px; }
    </style>
</head>
<body>

<nav class="mb-3">
    <a href="{{ url_for('candidatura') }}" class="btn btn-secondary">Candidatura</a>
    <a href="{{ url_for('matricula') }}" class="btn btn-primary">Matrícula</a>
    <a href="{{ url_for('relatorio') }}" class="btn btn-info text-white">Relatório</a>
    <a href="{{ url_for('logout') }}" class="btn btn-danger float-end">Sair</a>
</nav>

<div class="container">
    <h2>Atualizar Matrículas</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>1ª Prestação (€)</th>
                        <th>Resultado</th>
                        <th>Matrícula</th>
                        <th>2ª Prestação (€)</th>
                        <th>3ª Prestação (€)</th>
                        <th>Total (€)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in registros %}
                    <tr>
                        <td>{{ r[0] }}</td>
                        <td>{{ r[1] }}</td>
                        <td>{{ "%.2f"|format(r[13]) }}</td>
                        <td>
                            <select name="resultado"> 
                                <option value="Selecionar Opção" {% if r[17]=='Selecionar Opção' %}selected{% endif %}>Selecionar Opção</option>
                                <option value="Admitido" {% if r[17]=='Admitido' %}selected{% endif %}>Admitido</option>
                                <option value="Excluído" {% if r[17]=='Excluído' %}selected{% endif %}>Excluído</option>
                                <option value="Em Análise" {% if r[17]=='Em Análise' %}selected{% endif %}>Em Análise</option>
                                <option value="Suplente" {% if r[17]=='Suplente' %}selected{% endif %}>Suplente</option>
                                <option value="Não Admitido" {% if r[17]=='Não Admitido' %}selected{% endif %}>Não Admitido</option>
                            </select>
                        </td>
                        <td>
                            <select name="matricula">
                                <option value="Selecionar Opção" {% if r[18]=='Selecionar Opção' %}selected{% endif %}>Selecionar Opção</option>
                                <option value="Matriculado" {% if r[18]=='Matriculado' %}selected{% endif %}>Matriculado</option>
                                <option value="Não Matriculado" {% if r[18]=='Não Matriculado' %}selected{% endif %}>Não Matriculado</option>
                            </select>
                        </td>
                        <td><input type="number" step="0.01" name="prestacao2" value="{{ "%.2f"|format(r[14] or 0) }}"></td>
                        <td><input type="number" step="0.01" name="prestacao3" value="{{ "%.2f"|format(r[15] or 0) }}"></td>
                        <td>{{ "%.2f"|format((r[13] or 0) + (r[14] or 0) + (r[15] or 0)) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <button type="submit" class="btn btn-success">Atualizar Matrículas</button>
        <a href="{{ url_for('candidatura') }}" class="btn btn-warning">Voltar para Candidatura</a>
    </form>
</div>

</body>
</html>
